\chapter{Обучение модели и анализ важности признаков}

\section{Описание алгоритма случайного леса}

Для классификации технического состояния асинхронного двигателя использовался алгоритм \textbf{случайного леса} (Random Forest), основанный на ансамблевом подходе объединения множества независимых решающих деревьев. Каждое дерево обучается на случайно выбранной подвыборке обучающих данных (bagging) и случайном подмножестве признаков, что снижает вероятность переобучения и повышает обобщающую способность модели.

Модель случайного леса характеризуется рядом преимуществ: устойчивостью к шуму и выбросам, возможностью работы с нелинейными зависимостями, а также встроенными механизмами оценки важности признаков. К недостаткам можно отнести сравнительно большую вычислительную сложность при построении ансамбля и снижение интерпретируемости по сравнению с отдельным решающим деревом.

% (при необходимости можно добавить рисунок с общей схемой работы RF)
% \begin{figure}[h!]
%     \centering
%     \includegraphics[width=0.8\textwidth]{../pics/random_forest_scheme.png}
%     \caption{Общая структура модели случайного леса.}
%     \label{fig:rf_scheme}
% \end{figure}

\section{Настройка и обучение модели}

Перед обучением проводилось масштабирование и нормализация признаков, после чего выборка данных разбивалась на обучающую и тестовую подвыборки в соотношении 80/20.  
Для повышения достоверности оценки качества классификации использовалась \textbf{стратифицированная кросс-валидация} с числом блоков \( k = 5 \).

Обучение выполнялось с подбором основных гиперпараметров модели (число деревьев, максимальная глубина, минимальное число выборок в узле и т.д.) на основе средних результатов кросс-валидации по метрике точности (Accuracy).

Метрики качества классификации включали:
\[
\text{Accuracy} = \frac{TP + TN}{TP + TN + FP + FN}, \quad
\text{Precision} = \frac{TP}{TP + FP}, \quad
\text{Recall} = \frac{TP}{TP + FN},
\]
\[
\text{F1} = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}},
\]
где \( TP, TN, FP, FN \) — количество истинных и ложных классификаций по классам.

\section{Оценка важности признаков}

Для интерпретации результатов классификации и анализа вклада отдельных признаков в процесс принятия решений использовались три метода оценки важности:

\begin{itemize}
    \item \textbf{MDI (Mean Decrease Impurity)} — среднее уменьшение неопределённости в узлах деревьев (встроенная метрика модели Random Forest).
    \item \textbf{Permutation Importance} — оценка снижения точности модели при случайном перемешивании значений каждого признака.
    \item \textbf{SHAP (SHapley Additive exPlanations)} — метод на основе теории Шепли, позволяющий количественно определить вклад каждого признака в предсказание модели.
\end{itemize}

Визуализация важности признаков для различных методов представлена на рисунках \ref{fig:feat_imp_mdi}–\ref{fig:feat_imp_shap}.  
Наиболее значимые признаки интерпретировались с точки зрения их физического смысла, что позволило установить корреляцию между вычисленными показателями и типами дефектов.

% \begin{figure}[h!]
%     \centering
%     \includegraphics[width=0.9\textwidth]{../pics/feat_importance_mdi.png}
%     \caption{Важность признаков по методу MDI (Mean Decrease Impurity).}
%     \label{fig:feat_imp_mdi}
% \end{figure}
%
% \begin{figure}[h!]
%     \centering
%     \includegraphics[width=0.9\textwidth]{../pics/feat_importance_perm.png}
%     \caption{Важность признаков по методу Permutation Importance.}
%     \label{fig:feat_imp_perm}
% \end{figure}
%
% \begin{figure}[h!]
%     \centering
%     \includegraphics[width=0.9\textwidth]{../pics/feat_importance_shap.png}
%     \caption{Важность признаков по методу SHAP.}
%     \label{fig:feat_imp_shap}
% \end{figure}

\section{Результаты и обсуждение}

Результаты обучения модели показали высокую точность классификации различных технических состояний электродвигателя.  
Анализ важности признаков позволил выявить наиболее информативные показатели, отражающие физические процессы в системе.  

\renewcommand{\arraystretch}{1.3}

% Таблица 1: Здоровый двигатель
\begin{table}[htbp]
\centering
\caption{Результаты анализа признаков для здорового двигателя}
\label{tab:healthy_motor_features}
\begin{tabular}{p{1cm} p{6cm} p{1.5cm} p{1.5cm} p{1.5cm} p{1.5cm}}
\toprule
\textbf{Ранг} & 
\textbf{Признак} &
\textbf{Среднее} & 
\textbf{СКО} &
\textbf{Мин} &
\textbf{Макс} \\
\midrule

1 & 
\textbf{СКЗ тока фазы} \newline
\textit{current\_phase\_a\_rms} & 
0,244 & 0,003 & 0,239 & 0,249 \\
\midrule

2 & 
\textbf{Размах огибающей тока} \newline
\textit{current\_phase\_a\_env\_ptp} & 
0,040 & 0,010 & 0,029 & 0,071 \\
\midrule

3 & 
\textbf{Показатель регулярности гармоник огибающей тока фазы} \newline
\textit{current\_phase\_a\_env\_harmonic\_regularity} & 
0,979 & 0,017 & 0,938 & 1,000 \\
\midrule

4 & 
\textbf{Дисбаланс энергии фаз А-Б} \newline
\textit{current\_phase\_a\_current\_phase\_b\_env\_energy\_imbalance} & 
0,145 & 0,141 & 0,003 & 0,524 \\
\midrule

5 & 
\textbf{Коэффициент формы} \newline
\textit{current\_phase\_a\_env\_form\_factor} & 
1,134 & 0,021 & 1,090 & 1,217 \\

\bottomrule
\end{tabular}
\end{table}

% Таблица 2: Неисправный подшипник
\begin{table}[htbp]
\centering
\caption{Результаты анализа признаков для неисправного подшипника}
\label{tab:faulty_bearing_features}
\begin{tabular}{p{1cm} p{6cm} p{1.5cm} p{1.5cm} p{1.5cm} p{1.5cm}}
\toprule
\textbf{Ранг} & 
\textbf{Признак} &
\textbf{Среднее} & 
\textbf{СКО} &
\textbf{Мин} &
\textbf{Макс} \\
\midrule

1 & 
\textbf{СКЗ тока фазы} \newline
\textit{current\_phase\_a\_rms} & 
0,244 & 0,003 & 0,238 & 0,256 \\
\midrule

2 & 
\textbf{Размах огибающей тока} \newline
\textit{current\_phase\_a\_env\_ptp} & 
0,043 & 0,016 & 0,029 & 0,110 \\
\midrule

3 & 
\textbf{Гармоническая составляющая мощности огибающей} \newline
\textit{current\_phase\_a\_env\_harmonic\_ratio} & 
0,837 & 0,168 & 0,291 & 1,000 \\
\midrule

4 & 
\textbf{Дисбаланс энергии фаз А-Б} \newline
\textit{current\_phase\_a\_current\_phase\_b\_env\_energy\_imbalance} & 
0,167 & 0,163 & 0,000 & 0,613 \\
\midrule

5 & 
\textbf{Энтропия Винера} \newline
\textit{current\_phase\_a\_env\_flatness} & 
2,49$\times$10$^{-5}$ & 6,74$\times$10$^{-6}$ & 7,98$\times$10$^{-6}$ & 4,76$\times$10$^{-5}$ \\

\bottomrule
\end{tabular}
\end{table}

% Таблица 3: Несоосность
\begin{table}[htbp]
\centering
\caption{Результаты анализа признаков для несоосности}
\label{tab:misalignment_features}
\begin{tabular}{p{1cm} p{6cm} p{1.5cm} p{1.5cm} p{1.5cm} p{1.5cm}}
\toprule
\textbf{Ранг} & 
\textbf{Признак} &
\textbf{Среднее} & 
\textbf{СКО} &
\textbf{Мин} &
\textbf{Макс} \\
\midrule

1 & 
\textbf{СКЗ тока фазы} \newline
\textit{current\_phase\_a\_rms} & 
0,275 & 0,005 & 0,267 & 0,287 \\
\midrule

2 & 
\textbf{Размах огибающей тока} \newline
\textit{current\_phase\_a\_env\_ptp} & 
0,040 & 0,010 & 0,030 & 0,092 \\
\midrule

3 & 
\textbf{Показатель регулярности гармоник огибающей тока фазы} \newline
\textit{current\_phase\_a\_env\_harmonic\_regularity} & 
0,969 & 0,018 & 0,938 & 1,000 \\
\midrule

4 & 
\textbf{Спектральная корреляция фаз А-Б} \newline
\textit{current\_phase\_a\_current\_phase\_b\_env\_spectral\_corr} & 
0,911 & 0,088 & 0,559 & 0,992 \\
\midrule

5 & 
\textbf{Доля мощности гармонических искажений (THD) огибающей тока фазы} \newline
\textit{current\_phase\_a\_env\_thd\_power\_frac} & 
0,438 & 0,101 & 0,203 & 0,589 \\

\bottomrule
\end{tabular}
\end{table}

% Таблица 4: Системная несоосность
\begin{table}[htbp]
\centering
\caption{Результаты анализа признаков для несоостности стенда}
\label{tab:system_misalignment_features}
\begin{tabular}{p{1cm} p{6cm} p{1.5cm} p{1.5cm} p{1.5cm} p{1.5cm}}
\toprule
\textbf{Ранг} & 
\textbf{Признак} &
\textbf{Среднее} & 
\textbf{СКО} &
\textbf{Мин} &
\textbf{Макс} \\
\midrule

1 & 
\textbf{СКЗ тока фазы А} \newline
\textit{current\_phase\_a\_rms} & 
0,224 & 0,004 & 0,218 & 0,238 \\
\midrule

2 & 
\textbf{Энтропия Винера} \newline
\textit{current\_phase\_a\_env\_flatness} & 
2,91$\times$10$^{-5}$ & 1,29$\times$10$^{-5}$ & 1,59$\times$10$^{-5}$ & 9,15$\times$10$^{-5}$ \\
\midrule

3 & 
\textbf{Коэффициент асимметрии} \newline
\textit{current\_phase\_a\_env\_skew} & 
0,409 & 0,663 & -0,344 & 3,372 \\
\midrule

4 & 
\textbf{Дисбаланс энергии фаз А-Б} \newline
\textit{current\_phase\_a\_current\_phase\_b\_env\_energy\_imbalance} & 
0,165 & 0,145 & 0,005 & 0,567 \\
\midrule

5 & 
\textbf{Спектральная корреляция фаз А-Б} \newline
\textit{current\_phase\_a\_current\_phase\_b\_env\_spectral\_corr} & 
0,903 & 0,077 & 0,591 & 0,991 \\

\bottomrule
\end{tabular}
\end{table}


\section*{Обсуждение результатов}

Анализ статистических характеристик признаков, представленных в таблицах~\ref{tab:healthy_motor_features}–\ref{tab:system_misalignment_features}, позволяет выделить ключевые тенденции, отражающие различия токовых сигналов при разных состояниях электродвигателя.

\textbf{1. СКЗ тока фазы (RMS).}
Данный показатель стабильно занимает первое место по значимости для всех состояний. 
Для случая несоосности наблюдается наибольшее среднее значение ($0{,}275$ против $0{,}244$ у здорового двигателя), что связано с повышением механических потерь и увеличением нагрузки на вал. 
При "несоосности стенда", напротив, среднее значение RMS снижается до $0{,}224$, что может указывать на ???

\textbf{2. Размах огибающей тока.}
Размах огибающей (\textit{Envelope PTP}) увеличивается как при неисправности подшипника, так и при несоосности, отражая появление модуляций тока на частотах механических дефектов. 
Для подшипникового дефекта наблюдается наиболее широкий диапазон ($0{,}029$–$0{,}110$), что свидетельствует о неустойчивости момента и пульсациях при вращении ротора.

\textbf{3. Гармоническая структура огибающей.}
У исправного двигателя показатель регулярности гармоник (\textit{harmonic regularity}) близок к единице ($0{,}979$), что указывает на устойчивую синусоидальную структуру. 
При несоосности регулярность несколько снижается ($0{,}969$), а при неисправности подшипника смещается акцент на показатель \textit{harmonic ratio} ($0{,}837$), отражающий появление дополнительных частотных компонентов и возрастание гармонических искажений.

\textbf{4. Энергетический дисбаланс между фазами.}
Во всех случаях неисправностей данный показатель выше, чем у здорового состояния (с $0{,}145$ до $0{,}165$–$0{,}167$), что говорит о нарушении симметрии нагрузок и изменении распределения мощности между фазами. 
Это типичный признак механических или электромагнитных дефектов, приводящих к неравномерному потреблению энергии.

\textbf{5. Спектральная корреляция фаз А–Б.}
Наибольшая корреляция наблюдается у здорового двигателя (0,928), что указывает на синхронизированные токи фаз. 
При неисправности подшипника и при несоосности корреляция снижается до 0,910–0,911, отражая умеренное расхождение фазовых огибающих из-за гармонических возмущений. 
Системная несоосность даёт наименьшую корреляцию (0,903), что свидетельствует о более выраженном фазовом рассогласовании, вызванном взаимодействием двигателя и стенда (почему меньше чем у всех???).

\textbf{6. Доля мощности гармонических искажений (THD).}
- При несоосности THD растёт (0,438), что указывает на появление выраженных гармонических искажений при сохранении умеренной синхронизации фаз.  
- Для подшипникового дефекта THD умеренный, а корреляция фаз близка к здоровому состоянию -> возникают отдельные гармоники от ударов, но общая синхронизация фаз сохраняется.  
- При системной несоосности THD также высока, но корреляция фаз минимальна -> гармонические искажения сопровождаются фазовым рассогласованием токов.

\textbf{7. Энтропия Винера (Spectral Flatness).}
Для неисправного подшипника наблюдаются наименьшие значения ($2{,}49\times10^{-5}$), что свидетельствует о спектре с выраженными гармоническими пиками. 
При несоосности стенда значение энтропии немного выше ($2{,}91\times10^{-5}$), что указывает на более равномерное распределение спектральной энергии и шумоподобный характер огибающей.

\textbf{8. Коэффициент асимметрии (Skewness).}
Значительные положительные значения и разброс коэффициента асимметрии ($0{,}409 \pm 0{,}663$) характерны только для несоосности стенда, что говорит о несимметричных пульсациях момента и нестабильных колебательных процессах в системе «двигатель–нагрузка».

\bigskip
\textbf{Обобщая результаты:}
\begin{itemize}
    \item СКЗ тока и признаки огибающей позволяют надёжно дифференцировать механические неисправности.
    \item Подшипниковая неисправность характеризуется ростом гармонических составляющих и снижением спектральной равномерности.
    \item Несоосность сопровождается увеличением RMS и THD при высокой межфазной корреляции сигналов.
    \item Несоосность стенда проявляется в снижении RMS (почему??????) и появлении статистических признаков неустойчивости (асимметрия (почему в несоосности не развивается???), рост энтропии).
\end{itemize}


Сравнение методов оценки важности показало, что метрики SHAP обеспечивают наиболее интерпретируемое распределение вклада признаков, в то время как Permutation Importance позволяет оценить их влияние на итоговую точность модели.  
Результаты всех методов взаимно подтверждают выделение ключевых признаков, что указывает на устойчивость полученной модели и корректность выбора признакового пространства.
